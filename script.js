(function(){var t,e,i=function(t,e){return function(){return t.apply(e,arguments)}};document.addEventListener("DOMContentLoaded",function(){var e;return e=new t,e.start()}),e=function(t,i){return t&&(i(t)?t:e(t.parentNode,i))},t=function(){function t(){this.save_data=i(this.save_data,this),this.set_interval=i(this.set_interval,this),this.update_elapsed_time=i(this.update_elapsed_time,this),this.reset=i(this.reset,this),this.timers_stop=i(this.timers_stop,this),this.timer_resume=i(this.timer_resume,this),this.timer_go=i(this.timer_go,this),this.onclick=i(this.onclick,this),this.redraw_timers=i(this.redraw_timers,this),this.build_html=i(this.build_html,this),this.start=i(this.start,this),this.data=null!=localStorage.tempora?JSON.parse(localStorage.tempora):t["default"],this.interval=null}return t["default"]={active_timer:null,timers:[{id:"work",name:"Делу время",elapsed_seconds:0,timestamp:0},{id:"fun",name:"Потехе час",elapsed_seconds:0,timestamp:0}]},t.prototype.start=function(){return console.log("start"),this.build_html(),this.data.active_timer&&this.timer_resume(),document.addEventListener("click",this.onclick)},t.prototype.build_html=function(){var t,e,i,s,a,r,n;for(console.log("build_html"),a=this.data.timers,r=[],e=i=0,s=a.length;s>i;e=++i)n=a[e],t='<div class="timer-wrap" id="'+n.id+'">\n  <div class="timer-inner" data-i="'+e+'">\n      <h2>'+n.name+'</h2>\n      <span class="elapsed-time">'+this.format_time(n.elapsed_seconds)+"</span>\n  </div>\n</div>",r.push(document.body.insertAdjacentHTML("beforeend",t));return r},t.prototype.redraw_timers=function(){var t,e,i,s,a,r;for(console.log("redraw_timers"),a=this.data.timers,e=i=0,s=a.length;s>i;e=++i)r=a[e],t=document.getElementById(r.id),t.querySelectorAll(".elapsed-time").item(0).textContent=this.format_time(r.elapsed_seconds),e!==this.data.active_timer&&(document.body.classList.remove(r.id),t.classList.remove("active"));return this.data.active_timer?(document.body.classList.add(this.data.timers[this.data.active_timer].id),t=document.getElementById(this.data.timers[this.data.active_timer].id),t.classList.add("active"),document.getElementById("stop").disabled=!1):document.getElementById("stop").disabled=!0},t.prototype.format_time=function(t){var e,i;return e=Math.floor(t/3600),i=Math.floor(t%3600/60),(10>e?"0"+e:e)+":"+(10>i?"0"+i:i)},t.prototype.onclick=function(t){var i;if("BUTTON"===t.target.tagName){if(t.target.classList.contains("reset")&&this.reset(),t.target.classList.contains("stop"))return this.timers_stop()}else if(i=e(t.target,function(t){var e;return null!=(e=t.classList)?e.contains("timer-inner"):void 0}))return this.timer_go(i.getAttribute("data-i"))},t.prototype.timer_go=function(t){return console.log("timer_go",t),this.data.active_timer!==t?(this.data.active_timer=t,this.data.timers[t].timestamp=Date.now(),this.update_elapsed_time(),this.set_interval()):void 0},t.prototype.timer_resume=function(){return console.log("timer_resume"),this.update_elapsed_time(),this.set_interval()},t.prototype.timers_stop=function(){return console.log("timers_stop"),this.interval&&clearInterval(this.interval),this.update_elapsed_time(),this.data.timers[this.data.active_timer].timestamp=0,this.data.active_timer=null,this.save_data(),this.redraw_timers()},t.prototype.reset=function(){return console.log("reset"),this.interval&&clearInterval(this.interval),this.data=t["default"],this.save_data(),this.redraw_timers()},t.prototype.update_elapsed_time=function(){var t;return t=this.data.timers[this.data.active_timer],t.elapsed_seconds+=Math.round((Date.now()-t.timestamp)/1e3),t.timestamp=Date.now(),this.save_data(),this.redraw_timers()},t.prototype.set_interval=function(){return this.interval&&clearInterval(this.interval),this.interval=setInterval(function(t){return function(){return t.update_elapsed_time()}}(this),3e4)},t.prototype.save_data=function(){return console.log("save_data"),localStorage.tempora=JSON.stringify(this.data)},t}()}).call(this);